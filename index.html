<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>AI Image — GET Version</title>
<style>
:root{
  --bg:#0d1117;--panel:#0f1418;--card:#161b22;--border:#30363d;
  --text:#c9d1d9;--muted:#8b949e;--accent:#58a6ff
}
*{box-sizing:border-box}
body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto;background:var(--bg);color:var(--text);display:flex;flex-direction:column;min-height:100vh}
header{padding:12px 16px;border-bottom:1px solid var(--border);font-weight:700}
.container{flex:1;display:flex;flex-direction:column;gap:12px;padding:16px}
.controls{display:flex;gap:8px;align-items:center}
.input{flex:1;background:transparent;border:1px solid var(--border);padding:10px 12px;border-radius:10px;color:var(--text)}
.input:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 6px rgba(88,166,255,0.04)}
.btn{background:var(--accent);border:none;color:#000;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:700}
.btn:active{transform:translateY(1px)}
.small{font-size:13px;padding:6px 8px;border-radius:8px}
.previewWrap{max-width:920px;border:1px solid var(--border);background:var(--card);border-radius:10px;padding:12px}
.preview{display:block;width:100%;height:auto;border-radius:8px;max-height:70vh;object-fit:contain;background:#000}
.row{display:flex;gap:8px;align-items:center;margin-top:8px;flex-wrap:wrap}
.skeleton{width:100%;height:360px;border-radius:10px;background:linear-gradient(90deg,#0c0c0c 25%, #111214 50%, #0c0c0c 75%);background-size:200% 100%;animation:shimmer 1.6s infinite;border:1px solid var(--border)}
@keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
.error{color:#ffb5b5;background:rgba(255,100,100,0.04);padding:10px;border-radius:8px;border:1px solid rgba(255,100,100,0.07)}
.actions{display:flex;gap:8px}
.note{color:var(--muted);font-size:13px;margin-top:6px}
@media (max-width:820px){.previewWrap{padding:10px}.skeleton{height:260px}}
</style>
</head>
<body>
<header>AI Image — GET Version</header>

<div class="container">
  <div class="controls">
    <input id="prompt" class="input" placeholder="توضیح تصویر را به فارسی یا انگلیسی بنویس..." autocomplete="off" />
    <button id="generate" class="btn">تولید کن</button>
  </div>

  <div id="resultArea" class="previewWrap" aria-live="polite">
    <!-- پیش‌نمایش یا پیام خطا اینجا ظاهر می‌شود -->
    <div id="placeholder" class="skeleton" aria-hidden="true"></div>
    <div id="meta" style="display:none">
      <div id="actions" class="row actions">
        <button id="copyBtn" class="small btn">کپی آدرس</button>
        <a id="openBtn" class="small btn" target="_blank" rel="noopener">باز کردن</a>
        <a id="downloadBtn" class="small btn" download>دانلود</a>
      </div>
      <div id="status" class="note"></div>
    </div>
  </div>

  <div id="errorBox" style="display:none" class="error"></div>
</div>

<script>
(() => {
  const base = 'https://create-image.configfars.workers.dev/?q=';
  const promptInput = document.getElementById('prompt');
  const generateBtn = document.getElementById('generate');
  const placeholder = document.getElementById('placeholder');
  const resultArea = document.getElementById('resultArea');
  const meta = document.getElementById('meta');
  const errorBox = document.getElementById('errorBox');
  const copyBtn = document.getElementById('copyBtn');
  const openBtn = document.getElementById('openBtn');
  const downloadBtn = document.getElementById('downloadBtn');
  const status = document.getElementById('status');

  let imgEl = null;

  function setLoading() {
    errorBox.style.display = 'none';
    if (imgEl) imgEl.remove();
    placeholder.style.display = 'block';
    meta.style.display = 'none';
    status.textContent = 'در حال بارگذاری تصویر...';
  }

  function setError(msg) {
    placeholder.style.display = 'none';
    meta.style.display = 'none';
    errorBox.style.display = 'block';
    errorBox.textContent = msg;
  }

  function showImage(url, promptText) {
    placeholder.style.display = 'none';
    errorBox.style.display = 'none';
    if (imgEl) imgEl.remove();

    imgEl = document.createElement('img');
    imgEl.className = 'preview';
    imgEl.alt = promptText ? promptText : 'Generated image';
    // important: use the worker URL directly as src (GET)
    imgEl.src = url;

    // onload / onerror handlers
    imgEl.onload = () => {
      meta.style.display = 'block';
      status.textContent = 'نمایش تصویر برای: "' + (promptText || '') + '"';
      openBtn.href = url;
      downloadBtn.href = url;
      // note: cross-origin servers may block direct download via download attribute.
      // open in new tab is always available.
    };
    imgEl.onerror = () => {
      setError('بارگذاری تصویر با مشکل مواجه شد. ممکن است سرور پاسخ مناسبی برنگردانده باشد یا آدرس اشتباه باشد.');
      // still set open link for debugging
      openBtn.href = url;
      downloadBtn.href = url;
      meta.style.display = 'block';
      status.textContent = 'خطا در بارگذاری تصویر — می‌توانید روی "باز کردن" کلیک کنید.';
    };

    // insert image before the actions
    resultArea.insertBefore(imgEl, meta);
  }

  function buildUrl(prompt) {
    return base + encodeURIComponent(prompt);
  }

  generateBtn.addEventListener('click', () => {
    const p = promptInput.value.trim();
    if (!p) {
      setError('لطفاً یک توضیح برای تصویر وارد کنید.');
      return;
    }
    setLoading();
    const url = buildUrl(p);
    // set image src (no fetch) — browser will perform GET
    showImage(url, p);
    promptInput.value = '';
    promptInput.focus();
  });

  promptInput.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      generateBtn.click();
    }
  });

  copyBtn.addEventListener('click', () => {
    const target = imgEl ? imgEl.src : buildUrl(promptInput.value || '');
    if (!target) return;
    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(target).then(() => {
        const old = copyBtn.textContent;
        copyBtn.textContent = 'کپی شد';
        setTimeout(() => copyBtn.textContent = old, 1200);
      }).catch(() => alert('کپی ناموفق بود'));
    } else {
      promptInput.select();
      document.execCommand('copy');
      alert('کپی انجام شد (راه قدیمی)');
    }
  });

  // set sensible defaults
  promptInput.focus();
})();
</script>
</body>
</html>
